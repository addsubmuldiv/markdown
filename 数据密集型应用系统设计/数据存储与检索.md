#  数据存储方式

##  纯文本（key-value，逗号分割）



###  实现方式

每次追加新内容直接在文件末尾追加，多次更新某个值，不覆盖，直接在最后添加，读取的时候遍历所有，以最新的值为准



###   性能

写入来看是最高效的，只需在文件末尾追加就行，但是读取需要遍历，效率很低，因此引入索引



##  哈希索引

###  实现方式 

对所有数据进行哈希索引，如果采用追加式，则哈希存储偏移量

### 需要解决的问题

- 只追加到一个文件，那么如何避免最终用尽磁盘空间？
  - 一个好的解决方案是将日志分解成一定大小的段，当文件达到一定大小时就关闭它，并将后续写入到新的段文件中。然后可以在这些段上执行压缩
  - 压缩意味着在日志中丢弃重复的键，并且只保留每个键最近的更新
  - 由于压缩往往使得段更小（假设键在段内被覆盖多次），也可以在执行压缩的同时将多个段合并在一起

### 优势

每个段现在都有自己的内存哈希表，将键映射到文件的偏移量。为了找到键的值，首先检查最新的段的 hash map;如果键不存在，检査第二最新的段，以此类推。由于合并过程可以维持较少的段数量，因此查找通常不需要检查很多 hash map

### 问题

- 哈希表必须全部放入内存，如果在磁盘上，当大量IO，效率低下
- 查询效率不高，存储无序，以至于对于 key 连续的一些数据，得逐个找



## SSTables 和 LSM-Tree

### 实现方式





